<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¶é˜¿å¥‡ç›£è€ƒå„€è¡¨æ¿</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700;900&family=Roboto+Mono:wght@500;700&display=swap');

        /* é…è‰²å®šç¾© */
        :root {
            --duggee-yellow: #F7C902;
            --duggee-brown: #684E32;
            --tag-blue: #5BC2E7;
            --norrie-pink: #FF8CA1;
            --happy-green: #85C441;
            --roly-gray: #E2E8F0;
            --betty-purple: #9F7AEA;
            --bg-cream: #FFF9E6;
        }

        /* å…¨åŸŸæ¨£å¼è¨­å®š */
        body {
            font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
            overflow: hidden;
            background-color: var(--bg-cream);
            color: var(--duggee-brown);
            user-select: none;
        }

        /* éš±è—æ•¸å­—è¼¸å…¥æ¡†çš„ç®­é ­ */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* éš±è—æª”æ¡ˆè¼¸å…¥ */
        .hidden-input {
            display: none;
        }

        /* Modal å‹•ç•« */
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.9);
            }

            50% {
                opacity: 1;
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        .modal-animate {
            animation: bounceIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* è‡ªå®šç¾©æ»¾å‹•æ¢ - åœ“æ½¤é¢¨æ ¼ */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #FBD38D;
            border-radius: 99px;
            border: 2px solid var(--bg-cream);
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: #F6AD55;
        }

        /* å€’æ•¸è¨ˆæ™‚å­—é«” */
        .font-mono-timer {
            font-family: 'Roboto Mono', monospace;
            font-variant-numeric: tabular-nums;
        }

        /* è¡€æ¢éæ¸¡å‹•ç•« */
        .health-bar-transition {
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.5s ease;
        }

        /* Range Input Reset */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
        }

        input[type=range]:focus {
            outline: none;
        }

        .dashboard-time-input::-webkit-calendar-picker-indicator {
            display: none;
        }

        /* å¡é€šæ„Ÿé™°å½± */
        .cartoon-shadow {
            box-shadow: 4px 4px 0px rgba(104, 78, 50, 0.15);
        }

        .cartoon-shadow-lg {
            box-shadow: 6px 6px 0px rgba(104, 78, 50, 0.2);
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // --- é è¨­è³‡æ–™ ---
        const DEFAULT_SCHEDULE = [];

        // --- å·¥å…·å‡½å¼ ---
        const formatTime = (date) => {
            let h = date.getHours();
            const m = String(date.getMinutes()).padStart(2, '0');
            const s = String(date.getSeconds()).padStart(2, '0');
            const ampm = h >= 12 ? 'ä¸‹åˆ' : 'ä¸Šåˆ';
            h = h % 12;
            h = h ? h : 12;
            const hStr = String(h).padStart(2, '0');
            return `${ampm} ${hStr}:${m}:${s}`;
        };

        const parseTime = (timeStr) => {
            if (!timeStr) return 0;
            const [h, m] = timeStr.split(':').map(Number);
            return h * 3600000 + m * 60000;
        };

        const formatCountdown = (ms) => {
            if (ms < 0) ms = 0;
            const totalSeconds = Math.floor(ms / 1000);
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;

            if (h > 0) {
                return `${h}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
            }
            return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        };

        const formatAudioTime = (seconds) => {
            if (!seconds || isNaN(seconds) || !isFinite(seconds)) return "00:00";
            const m = Math.floor(seconds / 60);
            const s = Math.floor(seconds % 60);
            return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        };

        // --- Icons (åœ“æ½¤åŒ–) ---
        const IconUpload = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" /></svg>;
        const IconPlay = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M5 3l14 9-14 9V3z" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" /></svg>;
        const IconPause = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="none"><rect x="6" y="4" width="4" height="16" rx="2" /><rect x="14" y="4" width="4" height="16" rx="2" /></svg>;
        const IconReplay = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10" /><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" /></svg>;
        const IconSettings = ({ className = "w-[1.5vw] h-[1.5vw]" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>;
        const IconMaximize = ({ className = "w-[1.5vw] h-[1.5vw]" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" /></svg>;
        const IconClose = ({ className = "w-[1.5vw] h-[1.5vw]" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const IconTrash = ({ className = "w-[1vw] h-[1vw]" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
        const IconPlus = ({ className = "w-[1vw] h-[1vw]" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const IconMinus = ({ className = "w-[1vw] h-[1vw]" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const IconSync = ({ className = "w-[1vw] h-[1vw]" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>;
        const IconHelp = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>;
        const IconImage = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>;

        // --- Custom Tooltip Button Component (Portal Version) ---
        const TooltipButton = ({ onClick, icon: Icon, label, className, position = "right" }) => {
            const [show, setShow] = useState(false);
            const [coords, setCoords] = useState({ top: 0, left: 0 });
            const buttonRef = useRef(null);

            const handleMouseEnter = () => {
                if (buttonRef.current) {
                    const rect = buttonRef.current.getBoundingClientRect();
                    let top = 0;
                    let left = 0;
                    const offset = 8; // gap

                    // Calculate position based on prop
                    if (position === "top") {
                        top = rect.top - offset;
                        left = rect.left + rect.width / 2;
                    } else if (position === "bottom") {
                        top = rect.bottom + offset;
                        left = rect.left + rect.width / 2;
                    } else if (position === "left") {
                        top = rect.top + rect.height / 2;
                        left = rect.left - offset;
                    } else { // right
                        top = rect.top + rect.height / 2;
                        left = rect.right + offset;
                    }

                    setCoords({ top, left });
                    setShow(true);
                }
            };

            return (
                <>
                    <button
                        ref={buttonRef}
                        onClick={onClick}
                        className={className}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={() => setShow(false)}
                    >
                        <Icon />
                    </button>
                    {show && ReactDOM.createPortal(
                        <div
                            className="fixed z-[9999] px-3 py-1.5 text-xs font-bold text-[#684E32] bg-white border-2 border-[#F7C902] rounded-xl shadow-lg pointer-events-none transition-opacity duration-200"
                            style={{
                                top: coords.top,
                                left: coords.left,
                                transform: position === "top" ? "translate(-50%, -100%)" :
                                    position === "bottom" ? "translate(-50%, 0)" :
                                        position === "left" ? "translate(-100%, -50%)" :
                                            "translate(0, -50%)" // right
                            }}
                        >
                            {label}
                        </div>,
                        document.body
                    )}
                </>
            );
        };

        // --- Hooks ---
        const useSystemTime = () => {
            const [now, setNow] = useState(new Date());
            const [offset, setOffset] = useState(() => {
                const saved = localStorage.getItem('exam_clock_offset');
                return saved ? parseInt(saved, 10) : 0;
            });

            useEffect(() => {
                const timer = setInterval(() => setNow(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                localStorage.setItem('exam_clock_offset', offset);
            }, [offset]);

            const adjustedNow = useMemo(() => new Date(now.getTime() + offset), [now, offset]);
            const resetTime = () => setOffset(0);

            return { adjustedNow, resetTime };
        };

        const useScheduleStatus = (currentTime, schedule, extensions) => {
            return useMemo(() => {
                const currentMs = currentTime.getHours() * 3600000 + currentTime.getMinutes() * 60000 + currentTime.getSeconds() * 1000;

                let activeSlot = null;
                for (let slot of schedule) {
                    const startMs = parseTime(slot.start);
                    const extensionMs = extensions[slot.id] || 0;
                    const endMs = parseTime(slot.end) + extensionMs;

                    if (currentMs >= startMs && currentMs < endMs) {
                        activeSlot = { ...slot, startMs, endMs, durationMs: endMs - startMs, extensionMs };
                        break;
                    }
                }

                if (activeSlot) {
                    const elapsedMs = currentMs - activeSlot.startMs;
                    const remainingMs = activeSlot.durationMs - elapsedMs;
                    const progressPercent = Math.min(100, Math.max(0, (elapsedMs / activeSlot.durationMs) * 100));

                    // Duggee Status Colors
                    let color = 'bg-[#85C441]'; // Happy Green
                    let statusText = `${activeSlot.subject || 'æœ¬ç¯€'} é€²è¡Œä¸­`;
                    let title = "è€ƒè©¦é€²è¡Œä¸­";

                    if (remainingMs <= 10 * 60000) {
                        color = 'bg-[#FF8CA1]'; // Norrie Pink (Alert)
                        statusText = "è€ƒè©¦å³å°‡çµæŸ"; // Modified text
                        title = "å¿«è¦çµæŸå›‰";
                    } else if (remainingMs <= (activeSlot.durationMs - activeSlot.extensionMs) / 2) {
                        color = 'bg-[#F7C902]'; // Duggee Yellow
                        statusText = "æ™‚é–“éåŠï¼ŒåŠ æ²¹";
                        title = "åŠ æ²¹åŠ æ²¹";
                    }

                    if (activeSlot.extensionMs > 0) {
                        statusText = `å»¶é•·æ™‚é–“ (+${Math.round(activeSlot.extensionMs / 60000)}åˆ†)`;
                    } else if (activeSlot.extensionMs < 0) {
                        statusText = `ç¸®çŸ­æ™‚é–“ (${Math.round(activeSlot.extensionMs / 60000)}åˆ†)`;
                    }

                    return {
                        mode: 'ACTIVE',
                        slot: activeSlot,
                        remainingMs,
                        progress: progressPercent,
                        remainingPercent: 100 - progressPercent,
                        statusText,
                        title,
                        color
                    };
                }

                for (let slot of schedule) {
                    const extensionMs = extensions[slot.id] || 0;
                    const endMs = parseTime(slot.end) + extensionMs;
                    const freezeEndMs = endMs + 5 * 60000;

                    if (currentMs >= endMs && currentMs < freezeEndMs) {
                        return {
                            mode: 'ACTIVE',
                            slot: slot,
                            remainingMs: 0,
                            progress: 100,
                            remainingPercent: 0,
                            statusText: "è€ƒè©¦çµæŸ (ç·©è¡æœŸ)",
                            title: "ç­†æ”¾ä¸‹",
                            color: 'bg-[#FF6B6B]'
                        };
                    }
                }

                const nextSlot = schedule.find(slot => parseTime(slot.start) > currentMs);

                if (nextSlot) {
                    const nextStartMs = parseTime(nextSlot.start);
                    const remainingMs = nextStartMs - currentMs;

                    return {
                        mode: 'WAITING',
                        slot: nextSlot,
                        remainingMs,
                        progress: 0,
                        remainingPercent: 100,
                        statusText: `å³å°‡é–‹å§‹ï¼š${nextSlot.subject}`,
                        title: "æº–å‚™è€ƒè©¦",
                        color: 'bg-[#5BC2E7]' // Tag Blue
                    };
                }

                return {
                    mode: 'FINISHED',
                    slot: null,
                    remainingMs: 0,
                    progress: 0,
                    remainingPercent: 0,
                    statusText: "ä»Šæ—¥è¡Œç¨‹çµæŸ",
                    title: "å†è¦‹ï¼",
                    color: 'bg-[#E2E8F0]'
                };

            }, [currentTime, schedule, extensions]);
        };

        // --- SettingsModal ---
        const SettingsModal = ({ isOpen, onClose, schedule, setSchedule, examData, setExamData, setIdleImage, idleImage }) => {
            const [activeTab, setActiveTab] = useState('schedule');
            const [localSchedule, setLocalSchedule] = useState(schedule);
            const [localExamData, setLocalExamData] = useState(examData);
            const imageInputRef = useRef(null);

            useEffect(() => {
                if (isOpen) {
                    setLocalSchedule(JSON.parse(JSON.stringify(schedule)));
                    setLocalExamData({ ...examData });
                }
            }, [isOpen]);

            const handleSave = () => {
                setSchedule(localSchedule);
                setExamData(localExamData);
                onClose();
            };

            const handleScheduleChange = (index, field, value) => {
                const newSchedule = [...localSchedule];
                newSchedule[index] = { ...newSchedule[index], [field]: value };
                setLocalSchedule(newSchedule);
            };

            const addScheduleRow = () => {
                const newId = Math.random().toString(36).substr(2, 9);
                setLocalSchedule([...localSchedule, { id: newId, type: 'exam', start: '00:00', end: '00:00', label: '', subject: '' }]);
            };

            const removeScheduleRow = (index) => {
                const newSchedule = localSchedule.filter((_, i) => i !== index);
                setLocalSchedule(newSchedule);
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setIdleImage(reader.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-[#684E32]/40 backdrop-blur-sm p-4">
                    <div className="bg-[#FFF9E6] rounded-[2rem] shadow-2xl w-full max-w-5xl h-[90vh] flex flex-col overflow-hidden modal-animate border-4 border-[#F7C902]">
                        <div className="px-8 py-5 border-b-2 border-[#F7C902]/30 flex justify-between items-center bg-[#FFF5D7]">
                            <h2 className="text-2xl font-black text-[#684E32] flex items-center gap-3">
                                <span className="bg-[#F7C902] p-2 rounded-xl text-white"><IconSettings /></span>
                                ç›£è€ƒè¨­å®šå€
                            </h2>
                            <button onClick={onClose} className="p-2 hover:bg-[#F7C902]/20 rounded-full transition-colors text-[#684E32]"><IconClose /></button>
                        </div>
                        <div className="flex-1 flex overflow-hidden">
                            <div className="w-52 bg-[#FFF5D7] border-r-2 border-[#F7C902]/30 flex flex-col pt-6 gap-2 px-3">
                                {[
                                    { id: 'schedule', label: 'æ™‚ç¨‹è¨­å®š' },
                                    { id: 'attendance', label: 'è€ƒå ´è³‡è¨Š' },
                                    { id: 'background', label: 'èƒŒæ™¯è¨­å®š' },
                                    { id: 'help', label: 'ä½¿ç”¨èªªæ˜' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`px-4 py-3 text-left font-bold rounded-xl transition-all ${activeTab === tab.id
                                            ? 'bg-[#5BC2E7] text-white shadow-md transform scale-105'
                                            : 'text-[#684E32]/70 hover:bg-[#F7C902]/20'
                                            }`}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                            <div className="flex-1 overflow-y-auto p-8 bg-white/50">
                                {activeTab === 'schedule' && (
                                    <div className="space-y-6">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-xl font-bold text-[#684E32]">è€ƒè©¦æ™‚ç¨‹è¡¨è¨­å®š</h3>
                                            <button onClick={addScheduleRow} className="px-4 py-2 bg-[#85C441] text-white rounded-xl hover:bg-[#76b039] font-bold flex items-center gap-2 transition-all shadow-sm active:scale-95"><IconPlus className="w-4 h-4" /> æ–°å¢ç¯€æ¬¡</button>
                                        </div>
                                        <div className="rounded-2xl overflow-hidden border-2 border-[#F7C902]/30">
                                            <table className="w-full text-left border-collapse table-fixed">
                                                <thead className="bg-[#F7C902]/20 text-[#684E32] text-sm uppercase">
                                                    <tr>
                                                        <th className="p-4">ç§‘ç›®</th>
                                                        <th className="p-4 w-44 text-center">é–‹å§‹æ™‚é–“</th>
                                                        <th className="p-4 w-44 text-center">çµæŸæ™‚é–“</th>
                                                        <th className="p-4 w-20 text-center">åˆªé™¤</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-[#F7C902]/20 bg-white">
                                                    {localSchedule.length === 0 && (
                                                        <tr>
                                                            <td colSpan="4" className="p-8 text-center text-[#684E32]/50 font-bold text-lg">ç›®å‰æ²’æœ‰è¡Œç¨‹ï¼Œè«‹æŒ‰å³ä¸Šè§’æ–°å¢ï¼</td>
                                                        </tr>
                                                    )}
                                                    {localSchedule.map((row, index) => (
                                                        <tr key={row.id} className="hover:bg-[#FFF9E6]">
                                                            <td className="p-3"><input type="text" value={row.subject} onChange={(e) => handleScheduleChange(index, 'subject', e.target.value)} className="w-full p-3 border-2 border-[#E2E8F0] focus:border-[#5BC2E7] rounded-xl font-bold text-[#684E32] bg-[#F8FAFC]" placeholder="è¼¸å…¥ç§‘ç›®" /></td>
                                                            <td className="p-3"><input type="time" step="60" value={row.start} onChange={(e) => handleScheduleChange(index, 'start', e.target.value)} className="w-full p-2 border-2 border-[#E2E8F0] focus:border-[#5BC2E7] rounded-xl font-mono text-center bg-[#F8FAFC]" /></td>
                                                            <td className="p-3"><input type="time" step="60" value={row.end} onChange={(e) => handleScheduleChange(index, 'end', e.target.value)} className="w-full p-2 border-2 border-[#E2E8F0] focus:border-[#5BC2E7] rounded-xl font-mono text-center bg-[#F8FAFC]" /></td>
                                                            <td className="p-3 text-center"><button onClick={() => removeScheduleRow(index)} className="p-2 text-[#FF8CA1] hover:text-white hover:bg-[#FF8CA1] rounded-xl transition-colors"><IconTrash /></button></td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'attendance' && (
                                    <div className="max-w-2xl mx-auto space-y-8 py-8">
                                        <div className="bg-[#5BC2E7]/10 p-8 rounded-3xl border-2 border-[#5BC2E7]/30">
                                            <h3 className="text-xl font-bold text-[#5BC2E7] mb-6 flex items-center gap-2"><span className="w-2 h-6 bg-[#5BC2E7] rounded-full"></span>è€ƒå ´äººæ•¸</h3>
                                            <div className="grid grid-cols-2 gap-8">
                                                <div>
                                                    <label className="block text-sm font-bold text-[#684E32] mb-3 ml-1">æ‡‰åˆ°äººæ•¸</label>
                                                    <input type="number" value={localExamData.shouldArrive} onChange={(e) => setLocalExamData({ ...localExamData, shouldArrive: e.target.value })} className="w-full p-4 text-3xl font-black text-center text-[#5BC2E7] border-2 border-[#5BC2E7]/30 rounded-2xl focus:border-[#5BC2E7] outline-none bg-white shadow-sm" />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-[#85C441] mb-3 ml-1">å¯¦åˆ°äººæ•¸</label>
                                                    <input type="number" value={localExamData.actualArrive} onChange={(e) => setLocalExamData({ ...localExamData, actualArrive: e.target.value })} className="w-full p-4 text-3xl font-black text-center text-[#85C441] border-2 border-[#85C441]/30 rounded-2xl focus:border-[#85C441] outline-none bg-white shadow-sm" />
                                                </div>
                                            </div>
                                        </div>
                                        <div className="bg-[#FF8CA1]/10 p-8 rounded-3xl border-2 border-[#FF8CA1]/30">
                                            <h3 className="text-xl font-bold text-[#FF8CA1] mb-4 flex items-center gap-2"><span className="w-2 h-6 bg-[#FF8CA1] rounded-full"></span>ç¼ºè€ƒ/å‚™è¨»</h3>
                                            <textarea value={localExamData.absentList} onChange={(e) => setLocalExamData({ ...localExamData, absentList: e.target.value })} className="w-full h-32 p-4 text-xl font-bold text-[#FF8CA1] border-2 border-[#FF8CA1]/30 rounded-2xl focus:border-[#FF8CA1] outline-none resize-none bg-white shadow-sm" placeholder="è¼¸å…¥åº§è™Ÿ..." />
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'background' && (
                                    <div className="max-w-2xl mx-auto py-8">
                                        <div className="bg-[#FFF9E6] p-8 rounded-3xl border-2 border-[#F7C902]/20 text-center">
                                            <h3 className="text-xl font-black text-[#684E32] mb-4">é–’ç½®ç•«é¢è¨­å®š</h3>
                                            <p className="text-[#684E32]/70 mb-6">ç•¶æ²’æœ‰åœ¨è€ƒè©¦æ™‚ï¼ˆç­‰å¾…ä¸­æˆ–çµæŸï¼‰ï¼Œå³å´çœ‹æ¿æœƒé¡¯ç¤ºé€™å¼µåœ–ç‰‡ã€‚</p>

                                            <input type="file" accept="image/*" ref={imageInputRef} onChange={handleImageUpload} className="hidden" />

                                            <div className="flex flex-col items-center gap-4">
                                                <div
                                                    className="w-64 h-40 bg-gray-100 rounded-2xl border-2 border-dashed border-[#684E32]/30 flex items-center justify-center overflow-hidden cursor-pointer hover:bg-gray-50 transition-colors"
                                                    onClick={() => imageInputRef.current.click()}
                                                >
                                                    {idleImage ? (
                                                        <img src={idleImage} alt="Preview" className="w-full h-full object-cover" />
                                                    ) : (
                                                        <div className="text-[#684E32]/40 font-bold flex flex-col items-center gap-2">
                                                            <IconImage className="w-8 h-8" />
                                                            é»æ“Šä¸Šå‚³åœ–ç‰‡
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="flex gap-3">
                                                    <button onClick={() => imageInputRef.current.click()} className="px-4 py-2 bg-[#5BC2E7] text-white rounded-xl font-bold hover:bg-[#4ab0d4] transition-colors">é¸æ“‡åœ–ç‰‡</button>
                                                    {idleImage && <button onClick={() => setIdleImage(null)} className="px-4 py-2 bg-[#FF8CA1] text-white rounded-xl font-bold hover:bg-[#f57a90] transition-colors">æ¸…é™¤åœ–ç‰‡</button>}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'help' && (
                                    <div className="space-y-6 py-2">
                                        <div className="bg-[#FFF9E6] p-6 rounded-3xl border-2 border-[#F7C902]/20">
                                            <h3 className="text-xl font-black text-[#684E32] mb-3">ğŸ¶ æ­¡è¿ä¾†åˆ°é˜¿å¥‡ç›£è€ƒå„€è¡¨æ¿ï¼</h3>
                                            <p className="text-[#684E32]/80 leading-relaxed">
                                                é€™æ˜¯ä¸€å€‹å°ˆç‚ºè€å¸«è¨­è¨ˆçš„å¯æ„›é¢¨æ ¼ç›£è€ƒè¨ˆæ™‚å·¥å…·ã€‚ç„¡è«–æ˜¯æ®µè€ƒã€è‹±è½æ¸¬é©—æˆ–æ—¥å¸¸å°è€ƒï¼Œéƒ½èƒ½è¼•é¬†æŒæ§æ™‚é–“ï¼
                                            </p>
                                        </div>

                                        {/* å¿«é€Ÿé–‹å§‹ */}
                                        <div className="bg-gradient-to-r from-[#5BC2E7]/10 to-[#85C441]/10 p-5 rounded-2xl border-2 border-[#5BC2E7]/30">
                                            <h4 className="text-lg font-black text-[#5BC2E7] mb-3 flex items-center gap-2">
                                                <span className="text-2xl">âš¡</span> å¿«é€Ÿé–‹å§‹ï¼ˆé¦–æ¬¡ä½¿ç”¨å¿…çœ‹ï¼‰
                                            </h4>
                                            <ol className="space-y-2 text-sm text-[#684E32]/80 leading-relaxed ml-4">
                                                <li><strong>1.</strong> é»æ“Šå·¦ä¸Šè§’ âš™ï¸ è¨­å®šæŒ‰éˆ•</li>
                                                <li><strong>2.</strong> åœ¨ã€Œæ™‚ç¨‹è¨­å®šã€ä¸­æ–°å¢è€ƒè©¦ç¯€æ¬¡ï¼ˆç§‘ç›®ã€é–‹å§‹/çµæŸæ™‚é–“ï¼‰</li>
                                                <li><strong>3.</strong> åœ¨ã€Œè€ƒå ´è³‡è¨Šã€ä¸­å¡«å¯«æ‡‰åˆ°/å¯¦åˆ°äººæ•¸</li>
                                                <li><strong>4.</strong> é»æ“Šã€Œå®Œæˆè¨­å®šã€å„²å­˜</li>
                                                <li><strong>5.</strong> é»æ“Šå·¦ä¸Šè§’ ğŸ”² å…¨è¢å¹•æŒ‰éˆ•ï¼ŒæŠ•å½±åˆ°å¤§è¢å¹•çµ¦å­¸ç”Ÿçœ‹</li>
                                            </ol>
                                        </div>

                                        <div className="space-y-4">
                                            {/* åŠŸèƒ½èªªæ˜ 1 */}
                                            <div className="bg-white p-5 rounded-2xl border border-[#E2E8F0] flex gap-4">
                                                <div className="w-10 h-10 bg-[#5BC2E7] text-white rounded-full flex items-center justify-center font-black shrink-0">1</div>
                                                <div>
                                                    <strong className="block text-[#5BC2E7] text-lg mb-1">è¨­å®šè€ƒè©¦æ™‚é–“</strong>
                                                    <p className="text-sm text-[#684E32]/70 leading-relaxed">
                                                        é»æ“Šå·¦ä¸Šè§’çš„ <IconSettings className="inline w-4 h-4" /> è¨­å®šæŒ‰éˆ•ï¼Œé€²å…¥ã€Œæ™‚ç¨‹è¨­å®šã€ã€‚<br />
                                                        é»æ“Šã€Œæ–°å¢ç¯€æ¬¡ã€ï¼Œè¼¸å…¥ç§‘ç›®åç¨±ï¼ˆå¦‚ï¼šåœ‹èªï¼‰ã€é–‹å§‹æ™‚é–“èˆ‡çµæŸæ™‚é–“ã€‚<br />
                                                        <span className="text-[#5BC2E7] font-bold">ğŸ’¡ å°æŠ€å·§ï¼š</span> å¯ä»¥åœ¨ä¸»ç•«é¢ç›´æ¥é»æ“Šæ™‚é–“æ¬„ä½å¿«é€Ÿä¿®æ”¹ï¼
                                                    </p>
                                                </div>
                                            </div>

                                            {/* åŠŸèƒ½èªªæ˜ 2 */}
                                            <div className="bg-white p-5 rounded-2xl border border-[#E2E8F0] flex gap-4">
                                                <div className="w-10 h-10 bg-[#85C441] text-white rounded-full flex items-center justify-center font-black shrink-0">2</div>
                                                <div>
                                                    <strong className="block text-[#85C441] text-lg mb-1">æ’­æ”¾è‹±è½/éŸ³æ¨‚</strong>
                                                    <p className="text-sm text-[#684E32]/70 leading-relaxed">
                                                        åœ¨ä¸»ç•«é¢çš„ç§‘ç›®åˆ—è¡¨å³å´ï¼Œé»æ“Š <IconUpload className="inline w-4 h-4" /> æŒ‰éˆ•ä¸Šå‚³éŸ³è¨Šæª”ã€‚<br />
                                                        ä¸Šå‚³å¾Œæœƒå‡ºç¾æ’­æ”¾å™¨ï¼Œæ‚¨å¯ä»¥æ’­æ”¾ã€æš«åœï¼Œæˆ–æ˜¯ç›´æ¥æ‹–æ›³é€²åº¦æ¢åˆ°æƒ³è½çš„åœ°æ–¹ã€‚<br />
                                                        <span className="text-[#85C441] font-bold">ğŸ’¡ å°æŠ€å·§ï¼š</span> æ”¯æ´ MP3ã€WAV ç­‰å¸¸è¦‹éŸ³è¨Šæ ¼å¼ï¼
                                                    </p>
                                                </div>
                                            </div>

                                            {/* åŠŸèƒ½èªªæ˜ 3 */}
                                            <div className="bg-white p-5 rounded-2xl border border-[#E2E8F0] flex gap-4">
                                                <div className="w-10 h-10 bg-[#F7C902] text-white rounded-full flex items-center justify-center font-black shrink-0">3</div>
                                                <div>
                                                    <strong className="block text-[#F7C902] text-lg mb-1">è€ƒè©¦ä¸­çš„æ™‚é–“æ§åˆ¶</strong>
                                                    <p className="text-sm text-[#684E32]/70 leading-relaxed">
                                                        ç•¶è€ƒè©¦æ­£åœ¨é€²è¡Œæ™‚ï¼Œå³å´å¤§çœ‹æ¿æœƒé¡¯ç¤ºå€’æ•¸è¨ˆæ™‚ã€‚<br />
                                                        å¦‚éœ€å»¶é•·æˆ–ç¸®çŸ­æ™‚é–“ï¼Œé»æ“Šçœ‹æ¿ä¸‹æ–¹çš„ <span className="inline-block bg-[#85C441] text-white text-xs px-2 py-0.5 rounded font-bold">+1</span> <span className="inline-block bg-[#85C441] text-white text-xs px-2 py-0.5 rounded font-bold">+5</span> <span className="inline-block bg-[#85C441] text-white text-xs px-2 py-0.5 rounded font-bold">+10</span> æˆ– <span className="inline-block bg-[#FF8CA1] text-white text-xs px-2 py-0.5 rounded font-bold">-1</span> <span className="inline-block bg-[#FF8CA1] text-white text-xs px-2 py-0.5 rounded font-bold">-5</span> <span className="inline-block bg-[#FF8CA1] text-white text-xs px-2 py-0.5 rounded font-bold">-10</span> æŒ‰éˆ•ã€‚<br />
                                                        <span className="text-[#F7C902] font-bold">ğŸ’¡ å°æŠ€å·§ï¼š</span> æŒ‰éˆ•æœƒå¸¸é§é¡¯ç¤ºï¼Œæ–¹ä¾¿æ‚¨éš¨æ™‚èª¿æ•´ï¼
                                                    </p>
                                                </div>
                                            </div>

                                            {/* åŠŸèƒ½èªªæ˜ 4 - é¡è‰²æŒ‡ç¤º */}
                                            <div className="bg-white p-5 rounded-2xl border border-[#E2E8F0] flex gap-4">
                                                <div className="w-10 h-10 bg-[#9F7AEA] text-white rounded-full flex items-center justify-center font-black shrink-0">4</div>
                                                <div className="w-full">
                                                    <strong className="block text-[#9F7AEA] text-lg mb-2">é¡è‰²æŒ‡ç¤ºèªªæ˜</strong>
                                                    <div className="space-y-2 text-sm">
                                                        <div className="flex items-center gap-2">
                                                            <div className="w-4 h-4 bg-[#85C441] rounded"></div>
                                                            <span className="text-[#684E32]/70"><strong className="text-[#85C441]">ç¶ è‰²</strong> - è€ƒè©¦é€²è¡Œä¸­ï¼Œæ™‚é–“å……è£•</span>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <div className="w-4 h-4 bg-[#F7C902] rounded"></div>
                                                            <span className="text-[#684E32]/70"><strong className="text-[#F7C902]">é»ƒè‰²</strong> - æ™‚é–“éåŠï¼Œè«‹æ³¨æ„æ™‚é–“</span>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <div className="w-4 h-4 bg-[#FF8CA1] rounded"></div>
                                                            <span className="text-[#684E32]/70"><strong className="text-[#FF8CA1]">ç²‰ç´…</strong> - å‰©é¤˜ä¸åˆ° 10 åˆ†é˜ï¼Œå³å°‡çµæŸ</span>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <div className="w-4 h-4 bg-[#5BC2E7] rounded"></div>
                                                            <span className="text-[#684E32]/70"><strong className="text-[#5BC2E7]">è—è‰²</strong> - ç­‰å¾…ä¸‹ä¸€ç¯€è€ƒè©¦</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* åŠŸèƒ½èªªæ˜ 5 - å…¶ä»–åŠŸèƒ½ */}
                                            <div className="bg-white p-5 rounded-2xl border border-[#E2E8F0] flex gap-4">
                                                <div className="w-10 h-10 bg-[#FF8CA1] text-white rounded-full flex items-center justify-center font-black shrink-0">5</div>
                                                <div>
                                                    <strong className="block text-[#FF8CA1] text-lg mb-1">å…¶ä»–å¯¦ç”¨åŠŸèƒ½</strong>
                                                    <p className="text-sm text-[#684E32]/70 leading-relaxed space-y-1">
                                                        <span className="block"><strong>ğŸ“¸ èƒŒæ™¯åœ–ç‰‡ï¼š</strong> åœ¨è¨­å®šçš„ã€ŒèƒŒæ™¯è¨­å®šã€ä¸­ä¸Šå‚³åœ–ç‰‡ã€‚éè€ƒè©¦æœŸé–“æœƒé¡¯ç¤ºæ‚¨ä¸Šå‚³çš„åœ–ç‰‡ï¼ˆå¦‚æ ¡å¾½ã€æ¨™èªç­‰ï¼‰ã€‚åœ–ç‰‡æœƒç­‰æ¯”ä¾‹ç¸®æ”¾ï¼Œä¸æœƒè¢«è£åˆ‡ã€‚</span>
                                                        <span className="block"><strong>ğŸ”² å…¨è¢å¹•ï¼š</strong> é»æ“Šå·¦ä¸Šè§’çš„ <IconMaximize className="inline w-4 h-4" /> å¯ä»¥é€²å…¥å…¨è¢å¹•æ¨¡å¼ï¼Œé©åˆæŠ•å½±åˆ°å¤§è¢å¹•ã€‚å†æŒ‰ä¸€æ¬¡ ESC éµå³å¯é€€å‡ºã€‚</span>
                                                        <span className="block"><strong>ğŸ”„ æ™‚é–“æ ¡æ­£ï¼š</strong> å¦‚æœè¦ºå¾—æ™‚é–“ä¸æº–ï¼Œé»æ“Šæ™‚é–“æ—çš„ <IconSync className="inline w-3 h-3" /> åœ–ç¤ºé‡ç½®ç‚ºç³»çµ±æ™‚é–“ã€‚</span>
                                                        <span className="block"><strong>ğŸ‘¥ è€ƒå ´è³‡è¨Šï¼š</strong> åœ¨è¨­å®šä¸­å¡«å¯«æ‡‰åˆ°/å¯¦åˆ°äººæ•¸å’Œç¼ºè€ƒåº§è™Ÿï¼Œæ–¹ä¾¿è¨˜éŒ„ã€‚</span>
                                                    </p>
                                                </div>
                                            </div>

                                            {/* å¸¸è¦‹å•é¡Œ */}
                                            <div className="bg-gradient-to-r from-[#FF8CA1]/10 to-[#9F7AEA]/10 p-5 rounded-2xl border-2 border-[#FF8CA1]/30">
                                                <h4 className="text-lg font-black text-[#FF8CA1] mb-3 flex items-center gap-2">
                                                    <span className="text-2xl">â“</span> å¸¸è¦‹å•é¡Œ
                                                </h4>
                                                <div className="space-y-3 text-sm text-[#684E32]/80">
                                                    <div>
                                                        <strong className="text-[#684E32]">Q: æˆ‘çš„è¨­å®šæœƒè¢«ä¿å­˜å—ï¼Ÿ</strong>
                                                        <p className="ml-4 mt-1">A: æœƒçš„ï¼æ‰€æœ‰è¨­å®šï¼ˆæ™‚ç¨‹ã€è€ƒå ´è³‡è¨Šã€èƒŒæ™¯åœ–ç‰‡ï¼‰éƒ½æœƒè‡ªå‹•å„²å­˜åœ¨ç€è¦½å™¨ä¸­ï¼Œä¸‹æ¬¡é–‹å•Ÿæœƒè‡ªå‹•è¼‰å…¥ã€‚</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-[#684E32]">Q: å¯ä»¥åœ¨è€ƒè©¦ä¸­é€”ä¿®æ”¹æ™‚é–“å—ï¼Ÿ</strong>
                                                        <p className="ml-4 mt-1">A: å¯ä»¥ï¼ä½¿ç”¨ +/- æŒ‰éˆ•å³æ™‚èª¿æ•´ï¼Œæˆ–æ˜¯å›åˆ°è¨­å®šä¿®æ”¹çµæŸæ™‚é–“ã€‚</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-[#684E32]">Q: éŸ³è¨Šæª”æ¡ˆæœƒè¢«ä¿å­˜å—ï¼Ÿ</strong>
                                                        <p className="ml-4 mt-1">A: éŸ³è¨Šæª”æ¡ˆä¸æœƒä¿å­˜ï¼Œæ¯æ¬¡éœ€è¦é‡æ–°ä¸Šå‚³ã€‚å»ºè­°å°‡å¸¸ç”¨éŸ³æª”å­˜åœ¨é›»è…¦å›ºå®šä½ç½®ã€‚</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-[#684E32]">Q: å¦‚ä½•æ¸…é™¤æ‰€æœ‰è¨­å®šï¼Ÿ</strong>
                                                        <p className="ml-4 mt-1">A: åœ¨ç€è¦½å™¨ä¸­æ¸…é™¤æ­¤ç¶²ç«™çš„ Cookie å’Œç¶²ç«™è³‡æ–™å³å¯é‡ç½®ã€‚</p>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* è³‡æ–™å„²å­˜èªªæ˜ */}
                                            <div className="bg-[#FFF9E6] p-5 rounded-2xl border-2 border-[#F7C902]/30">
                                                <h4 className="text-lg font-black text-[#F7C902] mb-2 flex items-center gap-2">
                                                    <span className="text-2xl">ğŸ’¾</span> è³‡æ–™å„²å­˜èªªæ˜
                                                </h4>
                                                <p className="text-sm text-[#684E32]/80 leading-relaxed">
                                                    æœ¬ç³»çµ±ä½¿ç”¨ç€è¦½å™¨çš„ <strong>localStorage</strong> æŠ€è¡“å„²å­˜æ‚¨çš„è¨­å®šï¼Œæ‰€æœ‰è³‡æ–™éƒ½ä¿å­˜åœ¨æ‚¨çš„é›»è…¦ä¸Šï¼Œä¸æœƒä¸Šå‚³åˆ°ä»»ä½•ä¼ºæœå™¨ã€‚
                                                    è«‹æ³¨æ„ï¼šå¦‚æœæ›´æ›ç€è¦½å™¨æˆ–æ¸…é™¤ç€è¦½å™¨è³‡æ–™ï¼Œè¨­å®šå°‡æœƒéºå¤±ã€‚å»ºè­°å®šæœŸæˆªåœ–ä¿å­˜é‡è¦è¨­å®šã€‚
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                        <div className="px-8 py-5 border-t-2 border-[#F7C902]/30 bg-[#FFF5D7] flex justify-end gap-4">
                            <button onClick={onClose} className="px-6 py-3 rounded-2xl font-bold text-[#684E32]/60 hover:bg-[#F7C902]/10 transition-colors">å–æ¶ˆ</button>
                            <button onClick={handleSave} className="px-8 py-3 rounded-2xl font-bold bg-[#F7C902] text-[#684E32] shadow-lg hover:shadow-xl hover:bg-[#E6BC02] transition-all transform hover:-translate-y-1 cartoon-shadow">å®Œæˆè¨­å®š</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- ClockPanel ---
        const ClockPanel = ({ time, onReset, onOpenSettings }) => {
            const toggleFullscreen = () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(e => console.error(e));
                } else {
                    if (document.exitFullscreen) document.exitFullscreen();
                }
            };

            return (
                <div className="h-full flex items-center justify-center relative bg-[#F7C902] select-none border-r-4 border-white/20">
                    <div className="flex items-stretch gap-6">
                        <div className="flex flex-col justify-center gap-2 py-2">
                            <TooltipButton onClick={onOpenSettings} icon={IconSettings} label="è¨­å®š" className="p-3 bg-white/20 text-[#684E32] hover:bg-white/40 rounded-2xl transition-all" position="right" />
                            <TooltipButton onClick={toggleFullscreen} icon={IconMaximize} label="å…¨è¢å¹•" className="p-3 bg-white/20 text-[#684E32] hover:bg-white/40 rounded-2xl transition-all" position="right" />
                        </div>

                        <div className="flex flex-col justify-center group relative pl-6 border-l-2 border-[#684E32]/10 items-start">
                            <div className="flex items-center gap-2 mb-1">
                                <div className="text-[0.8vw] text-[#684E32]/60 font-black tracking-widest">CURRENT TIME</div>
                                <TooltipButton onClick={onReset} icon={IconSync} label="æ ¡æ­£" className="text-[#684E32]/40 hover:text-[#684E32] transition-colors scale-75" position="top" />
                            </div>
                            <div className="text-[3.5vw] font-black text-[#684E32] tabular-nums tracking-tighter leading-none text-left drop-shadow-sm">
                                {formatTime(time)}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const SubjectPanel = ({ status }) => {
            let subjectName = "ç„¡è€ƒè©¦";
            let subText = "ä¼‘æ¯ä¸€ä¸‹";
            if (status.mode === 'ACTIVE') {
                subjectName = status.slot.subject;
                subText = "æ­£åœ¨é€²è¡Œ";
            } else if (status.mode === 'WAITING') {
                subjectName = status.slot.subject;
                subText = "ä¸‹ä¸€ç¯€";
            } else if (status.mode === 'FINISHED') {
                subjectName = "ä»Šæ—¥çµæŸ";
                subText = "è¾›è‹¦äº†";
            }
            return (
                <div className="h-full w-full flex flex-col items-center justify-center relative bg-[#FFF9E6] p-6">
                    <div className="text-[1.5vw] font-bold text-[#684E32]/40 mb-2 tracking-widest uppercase">{subText}</div>
                    <div className="text-[4vw] font-black text-[#684E32] tracking-wide drop-shadow-sm">{subjectName}</div>
                </div>
            );
        };

        // --- CustomAudioScrubber (Duggee Style) ---
        const CustomAudioScrubber = ({ duration, currentTime, onSeek, fileName }) => {
            const containerRef = useRef(null);
            const [isDragging, setIsDragging] = useState(false);
            const [localTime, setLocalTime] = useState(0);
            const [hoverTime, setHoverTime] = useState(null);
            const [hoverPos, setHoverPos] = useState(0);
            const [showNameTooltip, setShowNameTooltip] = useState(false);
            const [tooltipPos, setTooltipPos] = useState({ x: 0, y: 0 });
            const nameContainerRef = useRef(null);

            useEffect(() => {
                if (!isDragging) {
                    setLocalTime(currentTime);
                }
            }, [currentTime, isDragging]);

            const calculateTime = useCallback((e) => {
                if (!containerRef.current || !duration) return 0;
                const rect = containerRef.current.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const x = Math.max(0, Math.min(clientX - rect.left, rect.width));
                return (x / rect.width) * duration;
            }, [duration]);

            const handleStart = (e) => {
                e.preventDefault();
                setIsDragging(true);
                if (e.target.setPointerCapture && e.pointerId) e.target.setPointerCapture(e.pointerId);
                const newTime = calculateTime(e);
                setLocalTime(newTime);
                onSeek(newTime);
            };

            const handleMove = (e) => {
                if (containerRef.current && duration) {
                    const rect = containerRef.current.getBoundingClientRect();
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const x = clientX - rect.left;
                    if (x >= 0 && x <= rect.width) {
                        setHoverPos(x);
                        setHoverTime((x / rect.width) * duration);
                    } else {
                        setHoverTime(null);
                    }
                }
                if (isDragging) {
                    const newTime = calculateTime(e);
                    setLocalTime(newTime);
                    onSeek(newTime);
                }
            };

            const handleEnd = () => { if (isDragging) setIsDragging(false); };
            const handleLeave = () => { if (!isDragging) setHoverTime(null); };

            const handleNameMouseEnter = () => {
                if (nameContainerRef.current) {
                    const rect = nameContainerRef.current.getBoundingClientRect();
                    setTooltipPos({ x: rect.left + rect.width / 2, y: rect.top });
                    setShowNameTooltip(true);
                }
            };

            const percent = duration ? (localTime / duration) * 100 : 0;

            return (
                <div className="w-full flex flex-col gap-1.5">
                    <div className="flex justify-between text-[11px] text-[#684E32]/60 font-bold font-mono px-1">
                        <span>{formatAudioTime(isDragging ? localTime : currentTime)}</span>
                        <span>{formatAudioTime(duration)}</span>
                    </div>

                    <div
                        ref={containerRef}
                        className="relative w-full h-5 group cursor-pointer flex items-center"
                        onPointerDown={handleStart}
                        onPointerMove={handleMove}
                        onPointerUp={handleEnd}
                        onPointerLeave={handleLeave}
                        onPointerCancel={handleEnd}
                    >
                        {/* Track */}
                        <div className="absolute w-full h-3 bg-[#E2E8F0] rounded-full pointer-events-none overflow-hidden shadow-inner border border-[#CBD5E0]">
                            <div className="h-full bg-[#5BC2E7] rounded-full" style={{ width: `${percent}%` }}></div>
                        </div>
                        {/* Thumb */}
                        <div className="absolute h-5 w-5 bg-[#F7C902] border-2 border-white rounded-full shadow-md transform -translate-x-1/2 pointer-events-none transition-transform group-hover:scale-110" style={{ left: `${percent}%` }}></div>
                        {hoverTime !== null && duration > 0 && (
                            <div className="absolute -top-7 transform -translate-x-1/2 bg-[#684E32] text-white text-[10px] px-2 py-1 rounded-lg font-bold shadow-sm pointer-events-none z-20 whitespace-nowrap" style={{ left: hoverPos }}>
                                {formatAudioTime(hoverTime)}
                            </div>
                        )}
                    </div>

                    <div
                        ref={nameContainerRef}
                        className="w-full h-4 relative mt-0.5 overflow-hidden"
                        onMouseEnter={handleNameMouseEnter}
                        onMouseLeave={() => setShowNameTooltip(false)}
                    >
                        <div className="text-[11px] text-[#684E32]/50 whitespace-nowrap truncate w-full cursor-default text-center">
                            {fileName}
                        </div>
                    </div>

                    {showNameTooltip && ReactDOM.createPortal(
                        <div
                            className="fixed z-[9999] transform -translate-x-1/2 -translate-y-full whitespace-nowrap px-3 py-1.5 text-xs font-bold text-[#684E32] bg-white border-2 border-[#F7C902] rounded-xl shadow-lg pointer-events-none mb-2"
                            style={{ top: tooltipPos.y, left: tooltipPos.x }}
                        >
                            {fileName}
                        </div>,
                        document.body
                    )}
                </div>
            );
        };

        const ScheduleRow = ({ slot, status, onSubjectChange, onTimeChange, onAudioRemove, audioState, onAudioUpload, onPlayPause, onReplay, onSeek }) => {
            const fileInputRef = useRef(null);

            const isActiveRow = status.slot && status.slot.id === slot.id;
            const isWaitingRow = status.mode === 'WAITING' && isActiveRow;
            const isRunningRow = status.mode === 'ACTIVE' && isActiveRow;

            // å¡ç‰‡æ¨£å¼é‚è¼¯
            let rowClass = 'bg-white border-2 border-transparent hover:border-[#F7C902]/30';
            let shadowClass = 'shadow-sm';

            if (isRunningRow) {
                rowClass = 'bg-[#FFF9E6] border-2 border-[#85C441]'; // Happy Green Border
                shadowClass = 'cartoon-shadow';
            } else if (isWaitingRow) {
                rowClass = 'bg-[#EBF8FF] border-2 border-[#5BC2E7]'; // Tag Blue Border
                shadowClass = 'shadow-md';
            }

            return (
                <div className={`relative flex items-center gap-4 px-5 py-4 mb-3 rounded-2xl transition-all duration-300 ${rowClass} ${shadowClass}`}>
                    {/* Time Inputs */}
                    <div className="flex flex-col items-center justify-center w-32 shrink-0 gap-1 bg-[#F8FAFC] rounded-xl p-2 border border-[#E2E8F0]">
                        <input
                            type="time"
                            step="60"
                            value={slot.start}
                            onClick={(e) => e.target.showPicker && e.target.showPicker()}
                            onChange={(e) => onTimeChange('start', e.target.value)}
                            className="dashboard-time-input text-lg font-bold text-[#684E32] font-mono tracking-tight bg-transparent text-center w-full outline-none cursor-pointer p-0 border-none"
                        />
                        <div className="w-8 h-0.5 bg-[#E2E8F0]"></div>
                        <input
                            type="time"
                            step="60"
                            value={slot.end}
                            onClick={(e) => e.target.showPicker && e.target.showPicker()}
                            onChange={(e) => onTimeChange('end', e.target.value)}
                            className="dashboard-time-input text-lg font-bold text-[#684E32] font-mono tracking-tight bg-transparent text-center w-full outline-none cursor-pointer p-0 border-none"
                        />
                    </div>

                    {/* Subject Input */}
                    <div className="flex-1 relative">
                        <input type="text" value={slot.subject} onChange={(e) => onSubjectChange(e.target.value)} className={`w-full text-2xl font-black bg-transparent border-none outline-none transition-colors placeholder-[#E2E8F0] ${isActiveRow ? 'text-[#684E32]' : 'text-[#684E32]/70'}`} placeholder="ç§‘ç›®åç¨±" />
                    </div>

                    {/* Audio Controls */}
                    <div className="flex flex-col items-end gap-1 w-48 shrink-0">
                        <input type="file" accept="audio/*" ref={fileInputRef} onChange={(e) => onAudioUpload(e.target.files[0])} className="hidden-input" />

                        <div className={`relative flex items-center w-full mb-1 h-8 ${!audioState.hasFile ? 'justify-end' : ''}`}>
                            {audioState.hasFile ? (
                                <>
                                    <div className="absolute -left-2 flex gap-1">
                                        <TooltipButton
                                            onClick={() => { fileInputRef.current.value = null; fileInputRef.current.click(); }}
                                            icon={IconUpload}
                                            label="æ›æª”"
                                            className="w-7 h-7 flex items-center justify-center text-[#5BC2E7] hover:bg-[#5BC2E7] hover:text-white rounded-full transition-colors"
                                            position="top"
                                        />
                                        <TooltipButton
                                            onClick={onAudioRemove}
                                            icon={IconTrash}
                                            label="åˆªé™¤"
                                            className="w-7 h-7 flex items-center justify-center text-[#FF8CA1] hover:bg-[#FF8CA1] hover:text-white rounded-full transition-colors"
                                            position="top"
                                        />
                                    </div>

                                    <div className="absolute left-1/2 transform -translate-x-1/2">
                                        <button onClick={onPlayPause} className={`flex items-center gap-1 px-3 py-1.5 rounded-full text-sm font-black text-white shadow-sm transition-transform active:scale-95 ${audioState.isPlaying ? 'bg-[#F6AD55]' : 'bg-[#48BB78]'}`}>
                                            {audioState.isPlaying ? <><IconPause /> æš«åœ</> : <><IconPlay /> æ’­æ”¾</>}
                                        </button>
                                    </div>

                                    <div className="absolute right-0">
                                        <TooltipButton
                                            onClick={onReplay}
                                            icon={IconReplay}
                                            label="é‡æ’­"
                                            className="w-7 h-7 flex items-center justify-center text-[#684E32]/50 hover:bg-[#684E32]/10 rounded-full transition-colors"
                                            position="top"
                                        />
                                    </div>
                                </>
                            ) : (
                                <button onClick={() => { fileInputRef.current.value = null; fileInputRef.current.click(); }} className="flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-bold text-[#5BC2E7] bg-[#5BC2E7]/10 hover:bg-[#5BC2E7] hover:text-white transition-colors">
                                    <IconUpload className="w-4 h-4" /> ä¸Šå‚³éŸ³è¨Š
                                </button>
                            )}
                        </div>

                        {audioState.hasFile && (
                            <CustomAudioScrubber
                                duration={audioState.duration}
                                currentTime={audioState.currentTime}
                                fileName={audioState.fileName}
                                onSeek={onSeek}
                            />
                        )}
                    </div>
                </div>
            );
        };

        const StatBox = ({ label, value, color, onChange, isTextArea = false }) => (
            <div className="flex flex-col items-center justify-start pt-5 px-4 pb-2 flex-1 relative first:border-r-2 last:border-l-2 border-[#684E32]/5">
                <span className="text-sm font-bold mb-2 text-[#684E32]/60 bg-white/50 px-3 py-1 rounded-full">{label}</span>
                <div className="w-full flex-1 flex items-center justify-center">
                    {isTextArea ? (
                        <textarea
                            value={value}
                            onChange={(e) => onChange(e.target.value)}
                            className="w-full h-full text-center bg-transparent text-xl font-bold outline-none resize-none placeholder-[#FF8CA1]/50 text-[#FF8CA1]"
                            placeholder="ç„¡"
                        />
                    ) : (
                        <input
                            type="number"
                            value={value}
                            onChange={(e) => onChange(e.target.value)}
                            className="w-full text-center bg-transparent text-5xl font-black outline-none placeholder-[#684E32]/10"
                            style={{ color: color }}
                            placeholder="-"
                        />
                    )}
                </div>
            </div>
        );

        const CountdownPanel = ({ status, onExtend, idleImage }) => {
            if (status.mode !== 'ACTIVE' && idleImage) {
                return (
                    <div className="w-full h-full bg-[#E2E8F0] flex flex-col items-center justify-center relative overflow-hidden">
                        <img src={idleImage} alt="Waiting" className="absolute inset-0 w-full h-full object-contain" />
                    </div>
                );
            }

            if (status.mode === 'FINISHED') {
                return (
                    <div className="w-full h-full bg-[#E2E8F0] flex flex-col items-center justify-center relative overflow-hidden">
                        <div className="text-8xl mb-4 opacity-50">ğŸ¶</div>
                        <h2 className="text-3xl font-black text-[#684E32]/50 mb-4 z-10">å¤§å®¶åšå¾—å¥½ï¼</h2>
                        <div className="text-lg text-[#684E32]/40 z-10 font-bold"></div>
                    </div>
                );
            }

            if (!status.slot) {
                return (
                    <div className="w-full h-full bg-[#F8FAFC] flex flex-col items-center justify-center relative overflow-hidden">
                        <div className="text-2xl font-bold text-[#684E32]/30">ç­‰å¾…æ™‚ç¨‹é–‹å§‹...</div>
                    </div>
                );
            }

            let timerColor = "text-[#684E32]";
            let timerBg = "bg-[#FFF9E6]";
            let labelColor = "text-[#684E32]";
            let labelBg = "bg-[#F7C902]";

            if (status.mode === 'WAITING') {
                labelBg = "bg-[#5BC2E7]";
                labelColor = "text-white";
                timerBg = "bg-[#EBF8FF]";
                timerColor = "text-[#5BC2E7]";
            } else {
                // Active
                timerBg = "bg-[#F0FFF4]";
                labelBg = "bg-[#85C441]";
                labelColor = "text-white";

                if (status.remainingMs < 10 * 60000) {
                    timerColor = "text-[#FF8CA1]";
                    labelBg = "bg-[#FF8CA1]";
                    timerBg = "bg-[#FFF5F7]";
                } else if (status.remainingMs < (status.slot.durationMs - status.slot.extensionMs) / 2) {
                    timerColor = "text-[#F6AD55]";
                    labelBg = "bg-[#F7C902]";
                    timerBg = "bg-[#FFFDE7]";
                }
                if (status.remainingMs === 0) {
                    timerColor = "text-[#FF6B6B]";
                    labelBg = "bg-[#FF6B6B]";
                }
            }

            return (
                <div className={`w-full h-full flex flex-col relative overflow-hidden ${timerBg} transition-colors duration-500`}>
                    <div className={`absolute top-0 left-0 px-[2vw] py-[1.5vh] text-[2vw] font-black rounded-br-[3rem] shadow-sm z-20 ${labelBg} ${labelColor} transition-colors duration-500`}>
                        {status.title}
                    </div>

                    <div className="flex-1 flex flex-col items-center justify-center relative z-10 mt-10">
                        {/* å€’æ•¸è¨ˆæ™‚ */}
                        <div className={`text-[13vw] font-black leading-none font-mono-timer tracking-tighter drop-shadow-sm ${timerColor} transition-colors duration-500`}>
                            {formatCountdown(status.remainingMs)}
                        </div>

                        {/* ç‹€æ…‹æ–‡å­— */}
                        <div className={`mt-2 text-[1.5vw] font-bold opacity-80 ${timerColor}`}>{status.statusText}</div>

                        {/* å¸¸é§é¡¯ç¤ºçš„åŠ æ¸›æ™‚æŒ‰éˆ• */}
                        {status.mode === 'ACTIVE' && (
                            <div className="mt-8 flex gap-[1.5vw] z-30">
                                <div className="flex gap-[0.5vw]">
                                    {[1, 5, 10].map(m => (
                                        <button key={m} onClick={() => onExtend(m)} className="w-[3.5vw] h-[2.5vw] bg-[#85C441] text-white font-black rounded-lg text-[1.2vw] hover:bg-[#76b039] active:scale-95 transition-all shadow-sm border-b-4 border-[#6ea033]">+{m}</button>
                                    ))}
                                </div>
                                <div className="flex gap-[0.5vw]">
                                    {[1, 5, 10].map(m => (
                                        <button key={m} onClick={() => onExtend(-m)} className="w-[3.5vw] h-[2.5vw] bg-[#FF8CA1] text-white font-black rounded-lg text-[1.2vw] hover:bg-[#f57a90] active:scale-95 transition-all shadow-sm border-b-4 border-[#e6758a]">-{m}</button>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="h-[2.5vh] w-full bg-[#E2E8F0]/50 relative mt-4">
                        <div className={`h-full health-bar-transition`} style={{ width: `${status.remainingPercent}%`, backgroundColor: status.remainingMs < 10 * 60000 ? '#FF8CA1' : '#85C441' }}>
                            <div className="absolute top-0 left-0 w-full h-1/3 bg-white/30"></div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const { adjustedNow, resetTime } = useSystemTime();
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [config, setConfig] = useState(() => {
                const saved = localStorage.getItem('exam_config_pro_v4');
                return saved ? JSON.parse(saved) : { schedule: DEFAULT_SCHEDULE };
            });
            const [examData, setExamData] = useState(() => {
                const saved = localStorage.getItem('exam_data_pro_v2');
                return saved ? JSON.parse(saved) : { shouldArrive: "", actualArrive: "", absentList: "" };
            });
            const [idleImage, setIdleImage] = useState(() => {
                return localStorage.getItem('exam_idle_image_v1') || null;
            });
            const [slotExtensions, setSlotExtensions] = useState({});
            const { schedule } = config;

            useEffect(() => { localStorage.setItem('exam_config_pro_v4', JSON.stringify(config)); }, [config]);
            useEffect(() => { localStorage.setItem('exam_data_pro_v2', JSON.stringify(examData)); }, [examData]);

            // Image persistence (with size check warning in console if too large, but simple try/catch)
            useEffect(() => {
                try {
                    if (idleImage) localStorage.setItem('exam_idle_image_v1', idleImage);
                    else localStorage.removeItem('exam_idle_image_v1');
                } catch (e) {
                    console.error("Image too large to save to localStorage", e);
                }
            }, [idleImage]);

            const status = useScheduleStatus(adjustedNow, schedule, slotExtensions);
            const [audioStates, setAudioStates] = useState({});
            const audioRefs = useRef({});

            const handleExtend = (minutes) => {
                if (status.mode !== 'ACTIVE' || !status.slot) return;
                const slotId = status.slot.id;
                setSlotExtensions(prev => ({ ...prev, [slotId]: (prev[slotId] || 0) + minutes * 60000 }));
            };

            const handleAudioUpload = (id, file) => {
                if (!file) return;
                const url = URL.createObjectURL(file);
                setAudioStates(prev => ({
                    ...prev,
                    [id]: { hasFile: true, isPlaying: false, progress: 0, src: url, currentTime: 0, duration: 0, fileName: file.name }
                }));
            };

            const handleAudioRemove = (id) => {
                const audio = audioRefs.current[id];
                if (audio) {
                    audio.pause();
                    audio.currentTime = 0;
                    audio.src = "";
                }
                if (audioStates[id]?.src) URL.revokeObjectURL(audioStates[id].src);
                setAudioStates(prev => ({ ...prev, [id]: { hasFile: false, isPlaying: false, progress: 0, src: null, currentTime: 0, duration: 0 } }));
            };

            const toggleAudio = (id) => {
                const audio = audioRefs.current[id];
                if (!audio) return;
                const isPlaying = !audioStates[id]?.isPlaying;
                if (isPlaying) {
                    Object.keys(audioRefs.current).forEach(key => {
                        if (key !== id && audioStates[key]?.isPlaying) {
                            audioRefs.current[key].pause();
                            setAudioStates(prev => ({ ...prev, [key]: { ...prev[key], isPlaying: false } }));
                        }
                    });
                    audio.play();
                } else {
                    audio.pause();
                }
                setAudioStates(prev => ({ ...prev, [id]: { ...prev[id], isPlaying } }));
            };

            const replayAudio = (id) => {
                const audio = audioRefs.current[id];
                if (!audio) return;
                audio.currentTime = 0;
                audio.play();
                Object.keys(audioRefs.current).forEach(key => {
                    if (key !== id && audioStates[key]?.isPlaying) {
                        audioRefs.current[key].pause();
                        setAudioStates(prev => ({ ...prev, [key]: { ...prev[key], isPlaying: false } }));
                    }
                });
                setAudioStates(prev => ({ ...prev, [id]: { ...prev[id], isPlaying: true } }));
            };

            const handleSeek = (id, time) => {
                const audio = audioRefs.current[id];
                if (!audio) return;
                if (isFinite(time)) audio.currentTime = time;
            };

            const handleAudioUpdate = (id, e) => {
                const { currentTime, duration } = e.target;
                const progress = duration ? (currentTime / duration) * 100 : 0;
                setAudioStates(prev => ({ ...prev, [id]: { ...prev[id], progress, currentTime, duration } }));
            };

            const handleAudioLoadedMetadata = (id, e) => {
                setAudioStates(prev => ({ ...prev, [id]: { ...prev[id], duration: e.target.duration } }));
            };

            const handleAudioEnded = (id) => {
                setAudioStates(prev => ({ ...prev, [id]: { ...prev[id], isPlaying: false, progress: 0, currentTime: 0 } }));
            };

            const updateSubject = (id, newSubject) => {
                const newSchedule = schedule.map(s => s.id === id ? { ...s, subject: newSubject } : s);
                setConfig(prev => ({ ...prev, schedule: newSchedule }));
            };

            const updateTime = (id, field, newValue) => {
                const newSchedule = schedule.map(s => s.id === id ? { ...s, [field]: newValue } : s);
                setConfig(prev => ({ ...prev, schedule: newSchedule }));
            };

            return (
                <div className="flex flex-col h-screen w-screen bg-[#FFF9E6] text-[#684E32] font-sans">
                    <div className="h-[30vh] bg-white shadow-lg z-20 flex flex-row relative">
                        <div className="w-[30%]">
                            <ClockPanel time={adjustedNow} onReset={resetTime} onOpenSettings={() => setIsSettingsOpen(true)} />
                        </div>
                        <div className="w-[70%]">
                            <SubjectPanel status={status} />
                        </div>
                        {/* Decorative Strip */}
                        <div className="absolute bottom-0 w-full h-2 bg-gradient-to-r from-[#F7C902] via-[#85C441] to-[#5BC2E7]"></div>
                    </div>
                    <div className="flex-1 flex flex-row overflow-hidden">
                        <div className="w-1/2 flex flex-col bg-white border-r-4 border-[#F7C902]/20 relative">
                            <div className="flex-1 overflow-y-auto p-4 bg-white">
                                {schedule.map((slot) => (
                                    <div key={slot.id}>
                                        <ScheduleRow
                                            slot={slot}
                                            status={status}
                                            onSubjectChange={(val) => updateSubject(slot.id, val)}
                                            onTimeChange={(field, val) => updateTime(slot.id, field, val)}
                                            onAudioRemove={() => handleAudioRemove(slot.id)}
                                            audioState={audioStates[slot.id] || { hasFile: false, isPlaying: false, progress: 0, currentTime: 0, duration: 0 }}
                                            onAudioUpload={(f) => handleAudioUpload(slot.id, f)}
                                            onPlayPause={() => toggleAudio(slot.id)}
                                            onReplay={() => replayAudio(slot.id)}
                                            onSeek={(time) => handleSeek(slot.id, time)}
                                        />
                                        <audio ref={el => audioRefs.current[slot.id] = el} src={audioStates[slot.id]?.src} onTimeUpdate={(e) => handleAudioUpdate(slot.id, e)} onLoadedMetadata={(e) => handleAudioLoadedMetadata(slot.id, e)} onEnded={() => handleAudioEnded(slot.id)} hidden />
                                    </div>
                                ))}
                            </div>
                            <div className="h-32 bg-[#F7C902]/10 border-t-2 border-[#F7C902]/30 flex flex-row shrink-0">
                                <StatBox label="æ‡‰åˆ°äººæ•¸" value={examData.shouldArrive} onChange={v => setExamData(p => ({ ...p, shouldArrive: v }))} color="#5BC2E7" />
                                <StatBox label="å¯¦åˆ°äººæ•¸" value={examData.actualArrive} onChange={v => setExamData(p => ({ ...p, actualArrive: v }))} color="#85C441" />
                                <StatBox label="æœªåˆ°åº§è™Ÿ/å‚™è¨»" value={examData.absentList} onChange={v => setExamData(p => ({ ...p, absentList: v }))} color="#FF8CA1" isTextArea={true} />
                            </div>
                        </div>
                        <div className="w-1/2 bg-[#FFF9E6]">
                            <CountdownPanel status={status} onExtend={handleExtend} idleImage={idleImage} />
                        </div>
                    </div>
                    <SettingsModal isOpen={isSettingsOpen} onClose={() => setIsSettingsOpen(false)} schedule={schedule} setSchedule={(newSch) => setConfig(prev => ({ ...prev, schedule: newSch }))} examData={examData} setExamData={setExamData} setIdleImage={setIdleImage} idleImage={idleImage} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>